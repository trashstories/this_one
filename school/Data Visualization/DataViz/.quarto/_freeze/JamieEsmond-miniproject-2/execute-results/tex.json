{
  "hash": "ad44a3ade81a9e22b5de424cf1488478",
  "result": {
    "markdown": "---\ntitle: \"Mini-Poject 2\"\nauthor: \"Jamie Pantazi Esmond\"\ndate: \"today\"\ndate-format: \"long\"\nformat: \n  html: \n    toc: true\n    theme: custom.scss\n    fig-cap-location: \"top\"\n    tbl-cap-location: \"top\"\n    title-block-banner: true\n    title-block-banner-color: \"#744FC6\"\n    fig-align: \"center\"\n  pdf: \n    toc: true\n    lof: true\n    mainfont: \"Cambria\"\n    fig-cap-location: \"top\"\n    code-line-numbers: true\n    fig-align: \"center\"\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\\newpage\n\n# Code and Plots\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)    # For ggplot, dplyr, and friends\nlibrary(countrycode)  # For dealing with country names, abbreviations, and codes\nlibrary(scales)\nlibrary(sf)\nlibrary(tigris)        # Access geographic data from the US Census\nlibrary(rnaturalearth)\nlibrary(ggrepel)\nlibrary(patchwork)\nlibrary(ggspatial)\nlibrary(ggsn)\nlibrary(waffle)\n\n\ncolors <- c(\"#CC0AA4\", \"#0ACCC5\", \"#3ACC14\", \"#7400CC\", \"#CCAC14\", \"#0E0ACC\")\n\nrefugees_raw <- read_csv(\"data/refugee_status.csv\", na = c(\"-\", \"X\", \"D\"))\n\nnon_countries <- c(\"Africa\", \"Asia\", \"Europe\", \"North America\", \"Oceania\", \n                   \"South America\", \"Unknown\", \"Other\", \"Total\")\n\nrefugees_clean <- refugees_raw %>%\n  mutate(diff = `2015` - `2006`) %>% \n  drop_na(diff) %>% \n  # Make this column name easier to work with\n  rename(origin_country = `Continent/Country of Nationality`) %>%\n  # Get rid of non-countries\n  filter(!(origin_country %in% non_countries)) %>%\n  # Convert country names to ISO3 codes\n  mutate(iso3 = countrycode(origin_country, \"country.name\", \"iso3c\",\n                            custom_match = c(\"Korea, North\" = \"PRK\"))) %>%\n  # Convert ISO3 codes to country names, regions, and continents\n  mutate(origin_country = countrycode(iso3, \"iso3c\", \"country.name\"),\n         origin_region = countrycode(iso3, \"iso3c\", \"region\"),\n         origin_continent = countrycode(iso3, \"iso3c\", \"continent\")) %>%\n  # Make this data tidy\n  gather(year, number, -origin_country, -iso3, -origin_region, \n         -origin_continent, -diff) %>%\n  # Make sure the year column is numeric + make an actual date column for years\n  mutate(year = as.numeric(year),\n         year_date = ymd(paste0(year, \"-01-01\"))) %>% \n  rename(ISO_A3 = iso3)\n\n\nworld_map <- read_sf(\"data/ne_110m_admin_0_countries/ne_110m_admin_0_countries/ne_110m_admin_0_countries.shp\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nref <- world_map %>% \n  left_join(refugees_clean, by = \"ISO_A3\") %>%\n  filter(ISO_A3 != \"ATA\") %>% \n  mutate(num = prettyNum(diff, big.mark = \",\"))\n  \n\neast <- ref %>% \n  filter(REGION_UN != \"Americas\") %>% \n  ggplot() +\n  geom_sf(aes(fill = diff)) +\n  scale_fill_steps2(low = \"#3DE5FF\",\n                    mid = \"#D3F1FF\",\n                    high = \"#A64900\",\n                    midpoint = 0,\n                    na.value = \"white\", \n                    breaks = c(-5000,0,5000,15000),\n                    label = label_number(scale_cut = cut_short_scale())) +\n  geom_label_repel(data = ref %>% filter(year == 2015, diff > 5000),\n                  aes(label = paste0(origin_country, \" 2015 +\", num), \n                      geometry = geometry),\n                  stat = \"sf_coordinates\", seed = 80085,\n                  size = 3, box.padding = 0.15, label.padding = 0.15,\n                  family = \"serif\", color = \"#2B004D\", fill = \"#CCc1DA\",\n                  alpha = .75) +\n  geom_label_repel(data = ref %>% filter(year == 2015, diff < -5000),\n                  aes(label = paste0(origin_country, \" 2015 \", num), \n                      geometry = geometry),\n                  stat = \"sf_coordinates\", seed = 80085,\n                  size = 3, box.padding = 0.15, label.padding = 0.15,\n                  family = \"serif\", color = \"#003781\", fill = \"#CDE8FD\",\n                  alpha = .75) +\n  north(location = \"bottomright\", scale = .375, symbol = 11, \n        anchor = c(x = 20000000, y = -100000),\n        x.min = -4500000, x.max = 16750000, \n        y.min = -5000000, y.max = 8500000) +\n  annotation_scale(bar_cols = c(\"#2B004D\", \"white\"),\n                   height = unit(0.15, \"cm\")) +\n  scale_x_continuous(limits = c(-4500000, 16750000)) +\n  scale_y_continuous(limits = c(-5000000, 8500000)) +\n  coord_sf(crs = st_crs(\"ESRI:102023\")) +  \n  labs(fill = \"Change in Number\\nof Refugees\\n2006-2015\",\n       title = \"Eastern Hemisphere\") +\n  theme_void() +\n  theme(legend.position = \"bottom\",\n        plot.title = element_text(family = \"serif\", \n                                  face = \"bold\", \n                                  size = 16),\n        legend.text = element_text(family = \"serif\"),\n        legend.title.align = .5,\n        legend.title = element_text(face = \"bold\", size = 8),\n        plot.background = element_rect(fill = \"white\", color = \"white\"))\n\neast\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n:::\n\n::: {.cell-output-display}\n![Eastern Hemisphere](JamieEsmond-miniproject-2_files/figure-pdf/east-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwest <- ref %>% \n  filter(REGION_UN == \"Americas\") %>% \n  ggplot() +\n  geom_sf(aes(fill = diff)) +\n  scale_fill_steps2(low = \"#3DE5FF\",\n                    mid = \"#D3F1FF\",\n                    high = \"#A64900\",\n                    midpoint = 0,\n                    na.value = \"white\",\n                    breaks = c(-2000,-1000,0),\n                    limits = c(-2000,1000),\n                    label = label_number(scale_cut = cut_short_scale())) +\n  geom_label_repel(data = ref %>% filter(year == 2015, GEOUNIT == \"Cuba\"),\n    aes(label = paste0(origin_country, \" 2015 \", num), geometry = geometry),\n    stat = \"sf_coordinates\", seed = 80085,\n    size = 3, box.padding = 0.15, label.padding = 0.15,\n    family = \"serif\", color = \"#003781\", fill = \"#CDE8FD\",\n    alpha = .75) +\n  geom_label_repel(data = ref %>% filter(year == 2015, GEOUNIT == \"Colombia\"),\n    aes(label = paste0(origin_country, \" 2015 +\", num), geometry = geometry),\n    stat = \"sf_coordinates\", seed = 80085,\n    size = 3, box.padding = 0.15, label.padding = 0.15,\n    family = \"serif\", color = \"#2B004D\", fill = \"#CCc1DA\",\n    alpha = .75) +\n  scale_x_continuous(limits = c(-4500000, 3500000)) +\n  scale_y_continuous(limits = c(-6000000, 3050000)) +\n  annotation_scale(bar_cols = c(\"#2B004D\", \"white\"),\n                   height = unit(0.15, \"cm\")) +\n  coord_sf(crs = st_crs(\"ESRI:102043\")) +\n  labs(fill = \"Change in Number\\nof Refugees\\n2006-2015\",\n       title = \"Western Hemisphere\") +\n  theme_void() +\n  theme(legend.position = \"bottom\",\n        plot.title = element_text(family = \"serif\", \n                                  face = \"bold\", \n                                  size = 16),\n        legend.text = element_text(family = \"serif\"),\n        legend.title.align = .5,\n        legend.title = element_text(face = \"bold\", size = 8),\n        plot.background = element_rect(fill = \"white\", color = \"white\"),\n        plot.margin = unit(c(0,80,0,0), \"pt\"))\n\nwest\n```\n\n::: {.cell-output-display}\n![Western Hemisphere](JamieEsmond-miniproject-2_files/figure-pdf/west-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nref1 <- refugees_clean %>%\n  drop_na(number) %>% \n  group_by(year, origin_region) %>% \n  summarise(reg_num = sum(number)) %>% \n  ggplot() +\n  geom_area(aes(year, reg_num, fill = origin_region),\n            linewidth = 1) +\n  facet_wrap(~ origin_region, nrow = 1) +\n  scale_x_continuous(breaks = seq(2006,2015,2)) +\n  scale_y_continuous(breaks = seq(0,25000,10000),\n                    label = label_number(scale_cut = cut_short_scale())) +\n  scale_fill_manual(values = colors, guide = \"none\") +\n  labs(x = NULL,\n       y = \"Number of Refugees\",\n       fill = NULL) +\n  theme_light() +\n  theme(strip.background = element_blank(),\n        strip.text = element_text(color = \"#2B004D\", family = \"serif\", size = 7),\n        panel.grid = element_blank(),\n        axis.text = element_text(family = \"serif\", size = 7),\n        axis.title = element_text(size = 8),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nref1\n```\n\n::: {.cell-output-display}\n![Area Chart](JamieEsmond-miniproject-2_files/figure-pdf/area-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombo <- ((west + east) / ref1) +\n  plot_layout(heights = c(.75,.25), widths = c(.45,.55)) +\n  plot_annotation(\"US Refugees from Around the World\", \n                  theme = theme(plot.title = element_text(size = 20, \n                                                          face = \"bold\", \n                                                          hjust = .5))) \n\ncombo\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n:::\n\n::: {.cell-output-display}\n![US Refugees from Around the World (2006-2015)](JamieEsmond-miniproject-2_files/figure-pdf/combo-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nggsave(\"output/combo.png\", width = 8, height = 8 / 1.618)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n:::\n\n```{.r .cell-code}\nggsave(\"output/combo.pdf\", width = 8, height = 8 / 1.618)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale on map varies by more than 10%, scale bar may be inaccurate\n```\n:::\n:::\n\n\n\n\\newpage\n\n# Final Graphic\n\n![US Refugees from Around the World (2005-2016)](output/enhanced.png)\n\n## Memo\n\nThe US receives refugees from all over the world, and over time, the countries and regions they come from change. In 2005, more refugees were arriving from Eastern Europe and Sub-Saharan Africa. Over the next ten years, the US saw an increase in refugees from the Middle East and Southeast Asia, while the number of refugees from Europe decreased. It is important to note that refugees must be granted refugee status before they come to the US; however, many people fleeing oppression and atrocities may choose to come to the US to seek asylum. Asylum seekers and refugees are similar, but refugees receive legal immigration status *before* they make the journey. This distinction explains why many more refugees come from the Eastern Hemisphere.\n\nBy utilizing a geographic visualization along with an area chart, the countries with more drastic changes between 2006 and 2016 are highlighted within the context of regional trends. The scale colors on the map uses a diverging palette to distinguish between countries where the number of refugees increased or decreased between 2006 and 2015, and the saturation increases with higher or lower changes. The countries represented on the map are grouped by region and the sum of refugees from those countries are represented by the colored area in each plot below the map. The edges of each element or plot are aligned with each other where ever possible to maintain a clean and polished graphic. The colors are contrasting but complimentary. \n\nWhile the data and this visualization tells part of the truth about refugees in the US, there is a lot of context missing; most importantly might be the number of people from each country who are denied refugee status (or what proportion of applicants are accepted). By taking this into consideration, as well as global events that have occurred (and the US's involvement in those events), this graphic can facilite the understanding of changes over the decade. ",
    "supporting": [
      "JamieEsmond-miniproject-2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}