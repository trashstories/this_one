{"title":"15: Hierarchical Models are Exciting","markdown":{"yaml":{"title":"15: Hierarchical Models are Exciting","editor_options":{"chunk_output_type":"console"}},"headingText":"Load packages","containsRefs":false,"markdown":"\n\n```{r, warning=FALSE, message=FALSE}\n\nlibrary(bayesrules)\nlibrary(tidyverse)\nlibrary(rstanarm)\nlibrary(broom.mixed)\nlibrary(lme4)\n\ncolors <- c( \"#7400CC\", \"#CC0AA4\", \"#0E0ACC\", \"#3ACC14\", \"#CCAC14\")\n\n```\n\n\n# 15.6.1 Conceptual exercises\n\n## Exercise 15.1 (Three pooling types: explain to your friend) \n\nIn one to two sentences each, explain the following concepts to your friend Hakeem, who has taken an intro statistics course but otherwise is new to pooled data.\n\na. Complete pooling\n   - **All observations are analyzed together in one group**\nb. No pooling\n   - **Each individually identified type of record (group) is analyzed on its own (i.e. one person, one lab, one tract, etc)**\nc. Partial pooling\n   - **Groups are analyzed separately but use information about the entire sample to inform predictions**\n\n## Exercise 15.2 (Three pooling types: redux) \n\nHakeem now understands the three pooling approaches thanks to your excellent explanations in the previous exercise. Now he has some follow-up questions! Answer these in your own words and using your own examples.\n\na. Can you give me an example when we might want to use the partial pooling approach?\n   - **When there are multiple records tied to the same entity**\nb. Why wouldn’t we always just use the complete pooling approach? It seems easier!\n   - **Complete pooling might miss trends within groups that provide more basis for accurate predictions**\nc. Does the no pooled approach have any drawbacks? It seems that there are fewer assumptions.\n   - **No pooled ignores information about the other groups which could lead to misinterpreted finding that only apply to specific groups**\nd. Can you remind me what the difference is between within-group variability and between-group variability? And how does that relate to partial pooling?\n   - **within-group - degree of the variability among multiple observations within each group**\n   - **between-group - variability from group to group**\n\n# 15.6.2 Applied exercises\n\nInterested in the impact of sleep deprivation on reaction time, Belenky et al. (2003) enlisted 18 subjects in a study. The subjects got a regular night’s sleep on “day 0” of the study, and were then restricted to 3 hours of sleep per night for the next 9 days. Each day, researchers recorded the subjects’ reaction times (in ms) on a series of tests. The results are provided in the `sleepstudy` dataset in the *lme4* package.\n\n## Exercise 15.3 (Hierarchical data) \n\nThe `sleepstudy` data is hierarchical. Draw a diagram in the spirit of Figure 15.8 that captures the hierarchical framework. Think: What are the “groups?”\n\n```{r}\n\nsleep <- sleepstudy\n\n```\n\n   - Records -> **Subject** -> Days \n\n## Exercise 15.4 (Complete pooling: Part I) \n\nSuppose that we (incorrectly) took a complete pooling approach to modeling `Reaction` time ($Y$) by `Days` of sleep deprivation ($X$).\n\na. To explore the complete pooled behavior of the data points, construct and discuss a plot of `Reaction` by `Days`. In doing so, ignore the subjects and include the observed trend in the relationship.\n\n```{r}\n\nsleep %>% \n  ggplot(aes(Days, Reaction)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point(aes(color = Subject)) + \n  theme_light()\n\n```\n\nb. Draw a diagram in the spirit of Figure 15.8 that captures the complete pooling framework.\n   - Records -> Days\n   \nc. Using careful notation, write out the structure for the complete pooled model of $Y$ by $X$.\n\n\\begin{equation}\nY_i | \\beta_0, \\beta_1, \\sigma \\stackrel{ind}{\\sim} N\\left(\\mu_i, \\sigma^2\\right) \\;\\; \\text{ with } \\;\\; \\mu_i = \\beta_0 + \\beta_1X_i\n\\end{equation}\n\n```{r, cache=TRUE}\n\ncomplete_pooled_model <- stan_glm(\n  Reaction ~ Days, \n  data = sleep, family = gaussian, \n  prior_intercept = normal(0, 2.5, autoscale = TRUE),\n  prior = normal(0, 2.5, autoscale = TRUE), \n  prior_aux = exponential(1, autoscale = TRUE),\n  chains = 4, iter = 5000*2, seed = 84735)\n\n# Posterior summary statistics\ntidy(complete_pooled_model, conf.int = TRUE, conf.level = 0.80)\n\n# Plot of the posterior median model\nsleep %>% \n  ggplot(aes(Days, Reaction, group = Subject)) + \n  geom_smooth(method = \"lm\", se = FALSE, color = \"#FF99F9\", size = 0.5) + \n  geom_abline(aes(intercept = 251, slope = 10.4), color = \"#7400CC\", linewidth = 1) + \n  theme_light()\n\n```\n\n## Exercise 15.5 (Complete pooling: Part II) \n\nIn the context of the sleep study, what two incorrect assumptions does the complete pooled model make and why are these inappropriate in the sleep study analysis?\n\n   - **That the reaction time will change consistently or similarly for all subjects.**\n\n## Exercise 15.6 (No pooling: Part I) \n\nSuppose instead that we (incorrectly) took a no pooling approach in our sleep study analysis.\n\na. To explore the no pooled behavior of the data points, construct and discuss separate scatterplots of `Reaction` by `Days` for each `Subject`, including subject-specific trend lines.\n\n```{r}\n\nsleep %>% \n  ggplot(aes(Days, Reaction, color = Subject)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point() + \n  theme_light()\n\n```\n\nb. Draw a diagram in the spirit of Figure 15.6 that captures the no pooling framework.\n   - Subject -> Days\n   \nc. Using careful notation, write out the structure for the no pooled model of $Y$ by $X$.\n\n\\begin{equation}\nY_{ij} | \\beta_{0j}, \\beta_{1j}, \\sigma \\sim N\\left(\\mu_{ij}, \\sigma^2\\right) \\;\\; \\text{ with } \\;\\; \\mu_{ij} = \\beta_{0j} + \\beta_{1j} X_{ij}\n\\end{equation}\n\n## Exercise 15.7 (No pooling: Part II) \n\nIn the context of the sleep study, what are the two main drawbacks to analyzing the relationship between reaction time and sleep deprivation using a no pooling approach?\n\n   - **Complete pooling does not consider the variance among subjects, and no pooling ignores the context of the other subjects.**\n\n## Exercise 15.8 (Complete vs no vs partial pooling) \n\nSuppose we only had data on the two subjects below. For both, provide a loose sketch of three separate trend lines corresponding to a complete pooled, no pooled, and partial pooled model of `Reaction` time by `Days`.\n\n```{r}\n\nsleep %>% \n  filter(Subject %in% c(\"308\", \"335\")) %>% \n  ggplot(aes(Days, Reaction)) +\n  geom_smooth(aes(color = Subject), method = \"lm\", se = FALSE, linewidth = 1.2) +\n  geom_abline(aes(intercept = 251, slope = 10.4), color = \"black\", linewidth = 1) + \n  geom_point(aes(color = Subject), size = 3) + \n  facet_wrap(~ Subject) +\n  scale_color_manual(values = colors) +\n  theme_light()\n\n```\n\n\n\n","srcMarkdownNoYaml":"\n\n```{r, warning=FALSE, message=FALSE}\n\n# Load packages\nlibrary(bayesrules)\nlibrary(tidyverse)\nlibrary(rstanarm)\nlibrary(broom.mixed)\nlibrary(lme4)\n\ncolors <- c( \"#7400CC\", \"#CC0AA4\", \"#0E0ACC\", \"#3ACC14\", \"#CCAC14\")\n\n```\n\n\n# 15.6.1 Conceptual exercises\n\n## Exercise 15.1 (Three pooling types: explain to your friend) \n\nIn one to two sentences each, explain the following concepts to your friend Hakeem, who has taken an intro statistics course but otherwise is new to pooled data.\n\na. Complete pooling\n   - **All observations are analyzed together in one group**\nb. No pooling\n   - **Each individually identified type of record (group) is analyzed on its own (i.e. one person, one lab, one tract, etc)**\nc. Partial pooling\n   - **Groups are analyzed separately but use information about the entire sample to inform predictions**\n\n## Exercise 15.2 (Three pooling types: redux) \n\nHakeem now understands the three pooling approaches thanks to your excellent explanations in the previous exercise. Now he has some follow-up questions! Answer these in your own words and using your own examples.\n\na. Can you give me an example when we might want to use the partial pooling approach?\n   - **When there are multiple records tied to the same entity**\nb. Why wouldn’t we always just use the complete pooling approach? It seems easier!\n   - **Complete pooling might miss trends within groups that provide more basis for accurate predictions**\nc. Does the no pooled approach have any drawbacks? It seems that there are fewer assumptions.\n   - **No pooled ignores information about the other groups which could lead to misinterpreted finding that only apply to specific groups**\nd. Can you remind me what the difference is between within-group variability and between-group variability? And how does that relate to partial pooling?\n   - **within-group - degree of the variability among multiple observations within each group**\n   - **between-group - variability from group to group**\n\n# 15.6.2 Applied exercises\n\nInterested in the impact of sleep deprivation on reaction time, Belenky et al. (2003) enlisted 18 subjects in a study. The subjects got a regular night’s sleep on “day 0” of the study, and were then restricted to 3 hours of sleep per night for the next 9 days. Each day, researchers recorded the subjects’ reaction times (in ms) on a series of tests. The results are provided in the `sleepstudy` dataset in the *lme4* package.\n\n## Exercise 15.3 (Hierarchical data) \n\nThe `sleepstudy` data is hierarchical. Draw a diagram in the spirit of Figure 15.8 that captures the hierarchical framework. Think: What are the “groups?”\n\n```{r}\n\nsleep <- sleepstudy\n\n```\n\n   - Records -> **Subject** -> Days \n\n## Exercise 15.4 (Complete pooling: Part I) \n\nSuppose that we (incorrectly) took a complete pooling approach to modeling `Reaction` time ($Y$) by `Days` of sleep deprivation ($X$).\n\na. To explore the complete pooled behavior of the data points, construct and discuss a plot of `Reaction` by `Days`. In doing so, ignore the subjects and include the observed trend in the relationship.\n\n```{r}\n\nsleep %>% \n  ggplot(aes(Days, Reaction)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point(aes(color = Subject)) + \n  theme_light()\n\n```\n\nb. Draw a diagram in the spirit of Figure 15.8 that captures the complete pooling framework.\n   - Records -> Days\n   \nc. Using careful notation, write out the structure for the complete pooled model of $Y$ by $X$.\n\n\\begin{equation}\nY_i | \\beta_0, \\beta_1, \\sigma \\stackrel{ind}{\\sim} N\\left(\\mu_i, \\sigma^2\\right) \\;\\; \\text{ with } \\;\\; \\mu_i = \\beta_0 + \\beta_1X_i\n\\end{equation}\n\n```{r, cache=TRUE}\n\ncomplete_pooled_model <- stan_glm(\n  Reaction ~ Days, \n  data = sleep, family = gaussian, \n  prior_intercept = normal(0, 2.5, autoscale = TRUE),\n  prior = normal(0, 2.5, autoscale = TRUE), \n  prior_aux = exponential(1, autoscale = TRUE),\n  chains = 4, iter = 5000*2, seed = 84735)\n\n# Posterior summary statistics\ntidy(complete_pooled_model, conf.int = TRUE, conf.level = 0.80)\n\n# Plot of the posterior median model\nsleep %>% \n  ggplot(aes(Days, Reaction, group = Subject)) + \n  geom_smooth(method = \"lm\", se = FALSE, color = \"#FF99F9\", size = 0.5) + \n  geom_abline(aes(intercept = 251, slope = 10.4), color = \"#7400CC\", linewidth = 1) + \n  theme_light()\n\n```\n\n## Exercise 15.5 (Complete pooling: Part II) \n\nIn the context of the sleep study, what two incorrect assumptions does the complete pooled model make and why are these inappropriate in the sleep study analysis?\n\n   - **That the reaction time will change consistently or similarly for all subjects.**\n\n## Exercise 15.6 (No pooling: Part I) \n\nSuppose instead that we (incorrectly) took a no pooling approach in our sleep study analysis.\n\na. To explore the no pooled behavior of the data points, construct and discuss separate scatterplots of `Reaction` by `Days` for each `Subject`, including subject-specific trend lines.\n\n```{r}\n\nsleep %>% \n  ggplot(aes(Days, Reaction, color = Subject)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_point() + \n  theme_light()\n\n```\n\nb. Draw a diagram in the spirit of Figure 15.6 that captures the no pooling framework.\n   - Subject -> Days\n   \nc. Using careful notation, write out the structure for the no pooled model of $Y$ by $X$.\n\n\\begin{equation}\nY_{ij} | \\beta_{0j}, \\beta_{1j}, \\sigma \\sim N\\left(\\mu_{ij}, \\sigma^2\\right) \\;\\; \\text{ with } \\;\\; \\mu_{ij} = \\beta_{0j} + \\beta_{1j} X_{ij}\n\\end{equation}\n\n## Exercise 15.7 (No pooling: Part II) \n\nIn the context of the sleep study, what are the two main drawbacks to analyzing the relationship between reaction time and sleep deprivation using a no pooling approach?\n\n   - **Complete pooling does not consider the variance among subjects, and no pooling ignores the context of the other subjects.**\n\n## Exercise 15.8 (Complete vs no vs partial pooling) \n\nSuppose we only had data on the two subjects below. For both, provide a loose sketch of three separate trend lines corresponding to a complete pooled, no pooled, and partial pooled model of `Reaction` time by `Days`.\n\n```{r}\n\nsleep %>% \n  filter(Subject %in% c(\"308\", \"335\")) %>% \n  ggplot(aes(Days, Reaction)) +\n  geom_smooth(aes(color = Subject), method = \"lm\", se = FALSE, linewidth = 1.2) +\n  geom_abline(aes(intercept = 251, slope = 10.4), color = \"black\", linewidth = 1) + \n  geom_point(aes(color = Subject), size = 3) + \n  facet_wrap(~ Subject) +\n  scale_color_manual(values = colors) +\n  theme_light()\n\n```\n\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"15_exercises.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.433","theme":"../custom.scss","title":"15: Hierarchical Models are Exciting","editor_options":{"chunk_output_type":"console"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}